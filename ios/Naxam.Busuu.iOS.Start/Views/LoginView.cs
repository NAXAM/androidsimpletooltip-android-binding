// This file has been autogenerated from a class added in the UI designer.

using System;

using Foundation;
using MvvmCross.Binding.BindingContext;
using MvvmCross.iOS.Views;
using MaterialControls;
using Naxam.Busuu.Start.ViewModel;
using ObjCRuntime;
using UIKit;
using FBKVOControllerNS;

namespace Naxam.Busuu.iOS.Start
{
    [MvxFromStoryboard(StoryboardName = "Start")]
    public partial class LoginView : MvxViewController<LoginViewModel>
	{
        MDTextField fieldEmailPhone;
        MDTextField fieldPass;
        FBKVOController _KVOController;
        bool Is1Animating;
        bool Is2Animating;

		public LoginView (IntPtr handle) : base (handle)
		{
		}

        public override void ViewDidLoad()
        {
            base.ViewDidLoad();

            this.NavigationController.NavigationBarHidden = false;

			fieldEmailPhone = new MDTextField();
			fieldEmailPhone.TextColor = UIColor.FromRGB(172, 180, 186);
            fieldEmailPhone.NormalColor = UIColor.FromRGB(172, 180, 186);
			fieldEmailPhone.HighlightColor = UIColor.FromRGB(57, 169, 246);
			fieldEmailPhone.LabelsFont = UIFont.SystemFontOfSize(14);
			fieldEmailPhone.InputTextFont = UIFont.SystemFontOfSize(14);
            fieldEmailPhone.ShouldBeginEditing = FieldEmailPhone_ShouldBeginEditing;
            fieldEmailPhone.ShouldEndEditing = FieldEmailPhone_ShouldEndEditing;
            fieldEmailPhone.Layer.Frame = new CoreGraphics.CGRect(0, 0, ViewEmail.Bounds.Width, ViewEmail.Bounds.Height);

			fieldPass = new MDTextField();
			fieldPass.TextColor = UIColor.FromRGB(172, 180, 186);
            fieldPass.NormalColor = UIColor.FromRGB(172, 180, 186);
			fieldPass.HighlightColor = UIColor.FromRGB(57, 169, 246);
			fieldPass.LabelsFont = UIFont.SystemFontOfSize(14);
			fieldPass.InputTextFont = UIFont.SystemFontOfSize(14);
            fieldPass.ShouldBeginEditing = FieldPass_ShouldBeginEditing;
            fieldPass.ShouldEndEditing = FieldPass_ShouldEndEditing;
            fieldPass.Layer.Frame = new CoreGraphics.CGRect(0, 0, ViewPassword.Bounds.Width, ViewPassword.Bounds.Height);

            ViewEmail.InsertSubview(fieldEmailPhone, 0);
            ViewPassword.InsertSubview(fieldPass, 0);

			ViewShadow.Layer.ShadowRadius = 2;
			ViewShadow.Layer.ShadowOpacity = 0.25f;
			ViewShadow.Layer.ShadowOffset = new CoreGraphics.CGSize(0, 2);

            btnFacebook.ContentEdgeInsets = new UIEdgeInsets(0, 16, 0, 0);
            btnGoogle.ContentEdgeInsets = new UIEdgeInsets(0, 16, 0, 0);

			btnFacebook.Layer.CornerRadius = btnFacebook.Frame.Height / 2;
            btnGoogle.Layer.CornerRadius = btnGoogle.Frame.Height / 2;

			viewbtnFacebook.Layer.CornerRadius = viewbtnFacebook.Frame.Height / 2;
			viewbtnGoogle.Layer.CornerRadius = viewbtnGoogle.Frame.Height / 2;

            viewbtnFacebook.Layer.ShadowRadius = 1.5f;
            viewbtnFacebook.Layer.ShadowOpacity = 0.25f;
            viewbtnFacebook.Layer.ShadowOffset = new CoreGraphics.CGSize(0, 1.5f);

            viewbtnGoogle.Layer.ShadowRadius = 1.5f;
            viewbtnGoogle.Layer.ShadowOpacity = 0.25f;
            viewbtnGoogle.Layer.ShadowOffset = new CoreGraphics.CGSize(0, 1.5f);

            btnLogin.Layer.CornerRadius = btnLogin.Frame.Height / 2;

			_KVOController = new FBKVOController(this);
            _KVOController.Observe(btnLogin, "enabled", NSKeyValueObservingOptions.Initial | NSKeyValueObservingOptions.New, UpdateBackgroundForItem);

			var setBind = this.CreateBindingSet<LoginView, LoginViewModel>();
            setBind.Bind(btnFacebook).To(vm => vm.LoginCommend);
            setBind.Bind(btnGoogle).To(vm => vm.LoginCommend);
            setBind.Bind(btnLogin).To(vm => vm.LoginCommend);
            setBind.Bind(btnForgotPassword).To(vm => vm.ForgotPasswordCommand);
            setBind.Bind(fieldEmailPhone).For(vm => vm.Text).To(vm => vm.TextEmail);
            setBind.Bind(fieldPass).For(vm => vm.Text).To(vm => vm.TextPass);
            setBind.Bind(btnLogin).For(vm => vm.Enabled).To(vm => vm.IsEnableLoginBtn);
			setBind.Apply();
		}

		void UpdateBackgroundForItem(NSObject arg0, NSObject arg1, NSDictionary<NSString, NSObject> arg2)
		{
			if (arg1 is UIButton item)
			{
				if (item.Enabled)
				{
					btnLogin.BackgroundColor = UIColor.FromRGB(57, 169, 246);
					btnLogin.Layer.ShadowRadius = 1.5f;
					btnLogin.Layer.ShadowOpacity = 0.25f;
					btnLogin.Layer.ShadowOffset = new CoreGraphics.CGSize(0, 1.5f);
				}
				else
				{
					btnLogin.BackgroundColor = UIColor.FromRGB(214, 222, 230);
					btnLogin.Layer.ShadowRadius = 0;
					btnLogin.Layer.ShadowOpacity = 0;
					btnLogin.Layer.ShadowOffset = new CoreGraphics.CGSize(0, 0);
				}
			}
		}

        bool FieldEmailPhone_ShouldBeginEditing(MDTextField textField)
        {
			Is1Animating = true;
            if (!Is2Animating)
            {
                StartAnimation();
            }
            else
            {
                Is2Animating = false;
            }

            viewLineEmail.BackgroundColor = UIColor.FromRGB(57, 169, 246);
			fieldEmailPhone.TextColor = UIColor.Black;
            if (fieldEmailPhone.Text == "Email address or phone number")
            {
				fieldEmailPhone.Text = "";          
            }

            return true;
        }

        bool FieldEmailPhone_ShouldEndEditing(MDTextField textField)
        {
            if (Is1Animating && !Is2Animating)
            {
                Is1Animating = false;
                StopAnimationC();
            }

            viewLineEmail.BackgroundColor = UIColor.Clear;
            if (fieldEmailPhone.Text == "" || fieldEmailPhone.Text == "Email address or phone number")
            {
                
				fieldEmailPhone.TextColor = UIColor.FromRGB(172, 180, 186);
                fieldEmailPhone.NormalColor = UIColor.FromRGB(172, 180, 186);
                fieldEmailPhone.Text = "Email address or phone number";
            }
            else
            {
                fieldEmailPhone.TextColor = UIColor.Black;
                fieldEmailPhone.NormalColor = UIColor.FromRGB(238, 93, 78);
            }

            return true;
        }

		bool FieldPass_ShouldBeginEditing(MDTextField textField)
		{
			Is2Animating = true;
            if (!Is1Animating)
            {
                StartAnimation();
            }		
            else
            {
				Is1Animating = false;
            }

            viewLinePass.BackgroundColor = UIColor.FromRGB(57, 169, 246);
            fieldPass.TextColor = UIColor.Black;
            fieldPass.SecureTextEntry = true;
            if (fieldPass.Text == "Password (minimum 6 characters)")
			{
                fieldPass.Text = "";
			}

			return true;
		}

		bool FieldPass_ShouldEndEditing(MDTextField textField)
		{
            if (Is2Animating && !Is1Animating)
            {
                Is2Animating = false;
                StopAnimationC();
            }

            viewLinePass.BackgroundColor = UIColor.Clear;
            if (fieldPass.Text == "" || fieldPass.Text == "Password (minimum 6 characters)")
			{
                fieldPass.TextColor = UIColor.FromRGB(172, 180, 186);
                fieldPass.NormalColor = UIColor.FromRGB(172, 180, 186);
                fieldPass.SecureTextEntry = false;
                fieldPass.Text = "Password (minimum 6 characters)";
			}
			else
			{
                fieldPass.TextColor = UIColor.Black;
                fieldPass.NormalColor = UIColor.FromRGB(238, 93, 78);
			}

			return true;
		}

        void StartAnimation()
        {
            UIView.BeginAnimations("connectAnimation");
            UIView.SetAnimationDuration(0.35);
            UIView.SetAnimationCurve(UIViewAnimationCurve.EaseOut);
            UIView.SetAnimationDelegate(this);
            UIView.SetAnimationDidStopSelector(new Selector("animationDidStop:finished:context:"));
            viewConnect.Alpha = 0;
            UIView.CommitAnimations();
        }

        void StopAnimation()
        {
            UIView.BeginAnimations("connectAnimation");
            UIView.SetAnimationDuration(0.35);
            UIView.SetAnimationCurve(UIViewAnimationCurve.EaseOut);
            UIView.SetAnimationDelegate(this);
            UIView.SetAnimationDidStopSelector(new Selector("animationDidStop:finished:context:"));
            viewConnect.Alpha = 1;
            UIView.CommitAnimations();
        }

		void StartAnimationC()
		{
            viewConnectTopConstraint.Constant =- viewConnect.Frame.Height;
			View.UpdateConstraintsIfNeeded();
			UIView.AnimateNotify(0.35, () =>
			{
				View.LayoutIfNeeded();
			}, (finished) =>
			{
				//IsAnimating = false;
			});
		}

        void StopAnimationC()
        {
			viewConnectTopConstraint.Constant = 24;
			View.UpdateConstraintsIfNeeded();
			UIView.AnimateNotify(0.35, () =>
			{
				View.LayoutIfNeeded();
			}, (finished) =>
			{
				//IsAnimating = false;
                StopAnimation();
			});
        }

		[Export("animationDidStop:finished:context:")]
		void SlideStopped(NSString animationID, NSNumber finished, NSObject context)
		{
            if (Is1Animating || Is2Animating)
			{
				viewConnect.Alpha = 0;
                StartAnimationC();
			}
			else
			{
                viewConnect.Alpha = 1;
			}
		}

		protected override void Dispose(bool disposing)
		{
			base.Dispose(disposing);
			if (_KVOController != null)
			{
				_KVOController.UnobserveAll();
				_KVOController.Dispose();
				_KVOController = null;
			}
		}
	}
}
